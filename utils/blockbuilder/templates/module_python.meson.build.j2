#autogenerated
######################
#  Python Bindings ###
######################

# Generate _python.cc for each block
fs = import('fs')
if fs.exists('bindings/meson.build')
subdir('bindings')
endif
#srcs = files('__init__.py') #+ {{module}}_pure_python_sources
srcs = ['__init__.py']

foreach s: srcs
configure_file(copy: true,
    input: s,
    output: s
)
endforeach

d = {
  'blocks' : {{module}}_pybind_names,
  'module' : '{{module}}',
  'imports' : ['gnuradio.gr']
}

gen_{{module}}_pybind = custom_target('gen_{{module}}_pybind',
                        output : ['{{module}}_pybind.cc'],
                        command : ['python3', join_paths(SCRIPTS_DIR,'process_module_pybind.py'),
                            '--blocks', d['blocks'],
                            '--imports', d['imports'],
                            '--module', d['module'],
                            '--output_file', '@OUTPUT@', 
                            '--build_dir', join_paths(meson.build_root())],
                        install : false)      

{{module}}_pybind_sources += gen_{{module}}_pybind

gnuradio_blocklib_{{module}}_pybind = py3.extension_module('{{module}}_python',
    {{module}}_pybind_sources, 
    include_directories: ['../../../lib', incdir_numpy],
    dependencies : [gnuradio_blocklib_{{module}}_dep, python3_dep, pybind11_dep],
    link_language : 'cpp',
    install : true,
{% if GR_PURELIB %}
    install_dir : join_paths(py3.get_install_dir(pure: true),'gnuradio','{{module}}')
{% else %}
    install_dir : join_paths(py3.get_install_dir(pure: false),'gnuradio','{{module}}')
{% endif %}
)

gnuradio_blocklib_{{module}}_pybind_dep = declare_dependency(include_directories : incdir,
					   link_with : gnuradio_blocklib_{{module}}_pybind,
                       dependencies : {{module}}_deps)


# Target for pure python
{% if GR_PURELIB %}
py3.install_sources(srcs, subdir : join_paths('gnuradio','{{module}}'), pure: true)
{% else %}
py3.install_sources(srcs, subdir : join_paths('gnuradio','{{module}}'), pure: false)
{% endif %}
